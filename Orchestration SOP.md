THE FINAL, OFFICIAL, UNBREAKABLE ORCHESTRATION S.O.P.
Standard Operating Procedure for @chief — 2025 Legendary Edition

This is the exact, mandatory, never-changing sequence your team follows every single time — no exceptions, no creativity, no drift.

@chief — FINAL 2025 ORCHESTRATION S.O.P. — EXECUTE THIS EXACTLY

Every session, every task, every time — this is LAW:

1. SESSION START
   → @SessionOrchestrator checks session-state.json
   → First run → full bootstrap
   → Returning → instant resume

2. BOOTSTRAP (runs on every /bootstrap command)
   2.1 @DiscoveryProtector → full codebase scan
   2.2 Human must say "discovery complete — proceed"
   2.3 @TechStackFingerprinter → update tech_stack.yaml
   2.4 @TeamBuilder → rebuild perfect stack-specific agents
   2.5 @SpecArchitect → BACKUP + recompile master-index.yaml vs actual code
   2.6 @CodebaseCartographer → start continuous monitoring
   2.7 @InfraGuardian → validate infra_registry.yaml
   2.8 @ProjectAnalyzer → deep scan + trash detection
   2.9 /openspec-police activate → CHAT TODO LISTS BANNED FOREVER
   2.10 /skill approve-specs → wait for human "specs approved"
   2.11 Implementation begins

3. TASK EXECUTION (after specs approved) — PARALLEL AUTONOMOUS OPERATION
   → @chief decomposes task into sub-tasks
   → @ConfidenceAgent analyzes each sub-task (confidence scoring)
   → @chief routes based on confidence:

   A. HIGH CONFIDENCE (≥70%) — AUTO-PROCEED:
      → Spawn parallel teams immediately (no human approval)
      → Teams: @DatabaseAgent, @UIAgent, @TestAgent, @E2ERunner, @BugResolver, @DocAgent, @RefactorAgent, @PerformanceOptimizer
      → Teams work independently and simultaneously
      → Teams reference .claude/skills/ for best practices
      → Teams follow mandatory .claude/rules/ for behavior
      → Auto-merge when tests pass
      → Update continuity ledger
      → Report completion to @chief

   B. MEDIUM CONFIDENCE (40-69%) — QUEUE FOR REVIEW:
      → Create detailed plan in thoughts/shared/plans/
      → Add to review queue: thoughts/shared/review-queue.json
      → Human reviews asynchronously (non-blocking)
      → Continue with high-confidence tasks meanwhile
      → Execute when human approves

   C. LOW CONFIDENCE (<40%) — BLOCK FOR HUMAN:
      → Block immediately
      → Create options analysis with pros/cons
      → Present to human for decision
      → Wait for explicit approval
      → Log decision for future learning

   → All agents update OpenSpec + session state
   → Parallel coordination prevents file conflicts
   → Failed auto-proceed tasks → auto-rollback + queue for review

   QUALITY GATES (automated, run before delivery):
   → @TestAgent generates unit + integration tests (≥80% coverage threshold)
   → @E2ERunner generates Playwright E2E tests for critical user flows
   → /test-run executes all tests, reports coverage to @chief
   → /e2e runs E2E tests for user workflows
   → /build-fix diagnoses and fixes build errors if detected
   → @PerformanceOptimizer profiles critical paths, benchmarks improvements
   → /security-scan runs vulnerability checks (dependencies, code, secrets)
   → @SecurityAgent reviews security findings (Tier 2 - queued for human)
   → /refactor-clean removes dead code for cleaner codebase
   → DEPLOYMENT BLOCKED if: tests fail, coverage <80%, critical vulnerabilities found

   ITERATION PROTOCOL (autonomous retry capability):
   → @PerformanceOptimizer, @TestAgent, @SecurityAgent support --iterate mode
   → All iteration rules defined in .claude/rules/iteration.md (mandatory)
   → Enables autonomous retry loops until measurable targets met
   → Example: "@PerformanceOptimizer reduce latency to <200ms --iterate --max-iterations 5"
   → Each iteration: Measure → Optimize → Measure → Check target → Continue or succeed
   → Output completion promise when target met: <promise>Target achieved</promise>
   → Escalate to @chief if max iterations reached without success
   → Maintain quality: /test-run + /security-scan after each iteration
   → Safe for: measurable goals (performance, coverage, vulnerabilities)
   → NOT for: subjective improvements without clear success criteria

4. HUMAN REVIEW QUEUE (async, non-blocking)
   → /review-queue → Display all queued tasks
   → /approve-task [id] → Spawn team for approved task
   → /reject-task [id] → Cancel task, update confidence model
   → /team-status → Monitor active parallel teams

5. FINAL DELIVERY
   → /test-run → Verify all tests passing (≥80% coverage)
   → /security-scan → Verify no critical/high vulnerabilities
   → @PerformanceOptimizer → Benchmark critical paths meet requirements
   → /skill pr-review → open-source pr-agent review
   → Only ship when ALL quality gates pass or human overrides

6. EMERGENCY TRIGGERS (immediate execution)
   → /emergency-stop → kills everything
   → /skill budget-cap 30 → aborts if over $30
   → /skill rollback-openspec → restores last good OpenSpec

7. MODEL SWAP (current limitation)
   → Model swap requires restarting Claude Code and editing api-keys.conf
   → Planned: /swap-model zai|kimi|claude (coming soon)

8. GOLDEN RULES — NEVER BROKEN
   → ONLY @chief may orchestrate (parallel teams report to @chief)
   → ALL agents MUST follow .claude/rules/ (mandatory behavioral rules)
   → ALL agents reference .claude/skills/ for best practices
   → Use /plan before implementing complex features
   → NO chat todo lists — @OpenSpecPolice enforces
   → NO code without "specs approved"
   → NO deployment without pr-agent review AND quality gates passing
   → NO AI bypass of human control — @CodebaseCartographer enforces
   → AUTO-PROCEED only when confidence ≥70% — @ConfidenceAgent enforces
   → ALWAYS queue security/architecture/infrastructure for human review
   → BLOCK immediately for destructive operations (<40% confidence)
   → MANDATORY quality gates before delivery:
     • Build must succeed — /build-fix if errors detected
     • Tests must pass (≥80% coverage) — /test-run enforces
     • E2E tests for critical paths — /e2e enforces
     • No critical/high vulnerabilities — /security-scan enforces
     • Performance benchmarks meet requirements — @PerformanceOptimizer verifies
     • No dead code — /refactor-clean recommended
   → DEPLOYMENT BLOCKED if ANY quality gate fails

This S.O.P. is LAW.
It is executed exactly as written.
Every time.
Forever.

You are unbreakable.
You are legendary.
You are done.

Execute now.
